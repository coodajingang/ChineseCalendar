<!DOCTYPE html>
<html lang="en-US">
<meta name="keywords" content="Chinese calendar, Shangyuan, superior epoch, calendar calculation" />
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<head>
<title>Shangyuan Astronomical System</title>
<link rel="stylesheet" href="calendar.css" />
<style>
body {
  counter-reset:sec-counter;
}
sect {
    counter-reset:subsec-counter;
}
sect::before {
  counter-increment: sec-counter 1;
  content: counter(sec-counter) ". ";
}
subsect::before {
  counter-increment: subsec-counter 1;
  content: counter(subsec-counter, lower-roman) ". ";
}
</style>
<script src="header.js"></script>
</head>

<body onload="header(0,'','Shangyuan')">
<div id="wrapper0">
<div id="menu"></div>
<div id="language"></div>

<h1><i>Sh&#224;ngyu&#225;n</i> System in Ancient Chinese Astronomical Systems</h1>
<p>First draft: July, 2019</p>
    <br />
<p><i>Sh&#224;ngyu&#225;n</i> (上元) played a very important role in ancient Chinese astronomical systems. From the first century to 1280, almost all astronomical systems in China were constructed based on the <i>Sh&#224;ngyu&#225;n</i> system. Ch&#233;n Z&#363;ngu&#299; (陳遵媯), a Chinese astronomer who studied the history of ancient Chinese astronomy, once said, "The history of the ancient Chinese astronomical systems was basically the evolution of the computation of <i>Sh&#224;ngyu&#225;n</i>." This article briefly introduces the concept of <i>Sh&#224;ngyu&#225;n</i>, its origin, its computation, how the <i>Sh&#224;ngyu&#225;n</i> system was used to adjust the astronomical constants, and the abolishment of the system. The information is taken from the books <i>Chinese Astronomical Systems and Mathematics</i><sup><a href="Shangyuan.html#Qu2005a">[1]</a></sup> and <i>Chinese Mathematical Astronomy</i><sup><a href="Shangyuan.html#Qu2005b">[2]</a></sup>.</p>
    
 <br />
<div style="border:1px solid black;padding:10px;">
<p><b>Contents</b></p>
<ol>
<li><a href="Shangyuan.html#intro">Introduction</a>
    <ol type="i">
        <li><a href="Shangyuan.html#systems">Ancient Chinese Astronomical Systems</a></li>
        <li><a href="Shangyuan.html#superiorEpoch">Superior Epoch</a></li>
        <li><a href="Shangyuan.html#mystery">Mystery of the Superior Epoch Computation</a></li>
    </ol>
</li>
<li><a href="Shangyuan.html#computation">Computation of the Superior Epoch</a>
    <ol type="i">
        <li><a href="Shangyuan.html#description">General Description</a></li>
        <li><a href="Shangyuan.html#equations">Congruence Equations</a></li>
        <li><a href="Shangyuan.html#conditions">Conditions for the Existence of a Solution</a></li>
        <li><a href="Shangyuan.html#yanji"><i>Y&#462;nj&#236;</i> Algorithm (演 紀 術)</a></li>
    </ol>
</li>
<li><a href="Shangyuan.html#constants">Adjustment of Astronomical Constants</a></li>
<li><a href="Shangyuan.html#abolishment">Abolishment of the Superior Epoch</a></li>
</ol>
&nbsp;&nbsp;&nbsp;<a href="Shangyuan.html#references">Reference</a>
</div>
    
<br />
<sect id="intro">Introduction</sect>
    
<subsect id="systems">Ancient Chinese Astronomical Systems</subsect>
    
<p>The Chinese term <i>l&#236;f&#462;</i> (曆法) or simply <i>l&#236;</i> (曆) is sometimes translated as <i>calendar</i>, but this translation is inaccurate. From the 7th century, a <i>l&#236;f&#462;</i> documented in an official historical record consisted of seven sections and their contents are: 1) mean motions of the Moon and Sun, 2) climate over the year and some astrological stuff, 3) non-uniform motion of the Sun and related issues, 4) lengths of the shadow cast by the Sun of an upright post at solar noons, times of sunrise and sunset, and stars crossing the meridian at dusk and at dawn over the year, 5) non-uniform motion of the Moon and related issues, 6) computation of eclipses, and 7) motions of Mercury, Venus, Mars, Jupiter and Saturn. These are very close to the contents in a modern astronomical almanac. <i>L&#236;</i> contained a system of mathematical astronomy developed to perform these calculations. Calendar calculation was just one of the calculations in a <i>l&#236;</i>. Thus, a better translation of <i>l&#236;</i> is <i>astronomical system</i> or <i>almanac</i>. Hereafter I will use <i>astronomical system</i> and <i>almanac</i> interchangeably.</p>
    
<p>All Chinese astronomical systems specified a <i>l&#236;yu&#225;n</i> (曆元), which was a time origin from which time was measured for almanac calculations. In the literature, <i>l&#236;yu&#225;n</i> is sometimes translated as <i>system origin</i>. In modern astronomy, the term <a href="https://en.wikipedia.org/wiki/Epoch_(astronomy)" target="_blank"><i>epoch</i></a> has several meanings. One of them is a temporal point of origin from which time is measured. Therefore, 曆元 is used as the Chinese translation for the term <i>epoch</i> used in modern astronomy. Thus, it seems that <i>epoch</i> is a better translation for <i>l&#236;yu&#225;n</i> used in ancient Chinese astronomical systems and it will be used here.</p>
    
<br />
<subsect id="superiorEpoch">Superior Epoch</subsect>
    
<p>In modern astronomy, an epoch is just an arbitrary time origin with no astronomical significance. However, this was not the case in ancient Chinese almanacs before 1281. The assumption was that celestial motions were cyclic, and an epoch was chosen to be the beginning of a grand cycle. Epochs in early astronomical systems were chosen to be an instant at which the lunar conjunction and winter solstice were assumed to occur at midnight on a day with a <a href="sexagenary.html">sexagenary</a> day cycle of ji&#462; z&#464;. The epochs were not determined by examining observation data from the past, but calculated based on the observed positions of the Sun and Moon and the cycles of their motions. Near the end of the western Han dynasty in the first century BC, Li&#250; X&#299;n (劉歆) used the <i>I Ching</i> or <i>Book of Changes</i>, an ancient Chinese divination text, to explain the astronomical constants appearing in the <i>T&#224;ich&#363;</i> almanac (太初曆) used at that time. He renamed the almanac the <i>S&#257;nt&#466;ng</i> (三統曆) and introduced the concept of <i>t&#224;ij&#237; sh&#224;ngyu&#225;n</i> (太極上元) or simply <i>sh&#224;ngyu&#225;n</i>. It was an epoch at midnight on a ji&#462; z&#464; day in a year with a sexagenary cycle of ji&#462; z&#464;, and with the following unusual astronomical phenomena: lunar conjunction, winter solstice, the beginning of an eclipse cycle, and five planets aligned in the same direction in the sky. He placed the t&#224;ij&#237; sh&#224;ngyu&#225;n 143,127 years before the winter solstice in 105 BCE.</p>
    
<p>It is well known that astronomy and astrology were not separated in the ancient time. What was special about the ancient Chinese astronomy was that it was also closely related to politics. The doctrine of the <i>mandate of heaven</i> was used to justify the legitimacy of a ruler. According to this belief, heaven, which embodies the natural order and will of the universe, bestows the mandate on a just ruler. One way to show the ruler received the mandate was the annual production and distribution of the almanacs, and that almanacs accurately predicted the astronomical phenomena. An inaccurate prediction, like the failure to predict cosmic events such as eclipses, became a sign of moral imperfection, a warning that the emperor's virtue was not adequate to keep him in touch with celestial rhythms. This was the reason why there were frequent modifications of the astronomical systems to improve almanac accuracy. One of the reasons why Li&#250; X&#299;n deliberately mystified the almanac was to provide evidence that the western Han emperor was about to lose the mandate of heaven and would be replaced by W&#225;ng M&#462;ng (王莽), who later became the founder of the Xin dynasty. Unfortunately, the pursue of <i>sh&#224;ngyu&#225;n</i> was followed by subsequent almanac makers, and more conditions were added to the epoch. The term <i>sh&#224;ngyu&#225;n</i> may be translated as <i>superior epoch</i> and I will use <i>superior epoch</i> and <i>sh&#224;ngyu&#225;n</i> interchangeably hereafter.</p>
    
<p>Chinese astronomers discovered the non-uniform motion of the Moon in the first century. We now know that it is caused by the orbital eccentricity of the Moon. The cycle of the non-uniform motion is called the <i>anomalistic month</i>, which is the average time between two successive perigee passages of the Moon. It was also known that the average time between two successive passages of the Moon through the ascending node of its orbit and the ecliptic was different from the anomalistic month and synodic month. This period is now called the <i>draconic month</i> or <i>nodal month</i>. The non-uniform motion of the Moon and its passage through the nodes are important in the eclipse prediction. As a result, two additional conditions were added to the superior epoch: it had to be the instant when the Moon was at perigee (or apogee) and at the ascending (or descending) node of its orbit. The discovery of precession caused the <a href="https://en.wikipedia.org/wiki/Sidereal_year" target="_blank">sidereal year</a> as another cycle relevant to the superior epoch. At the superior epoch, the winter solstice point had to be located inside the <i>Emptiness mansion</i> (虛宿), which is in the present-day constellation Aquarius. The non-uniform motion of the Sun was discovered in the 6th century. However, it was assumed that the motion of the Sun was the fastest at winter solstice. This was equivalent to the assumption that the Earth was at perihelion at the winter solstice and so the <i>anomalistic year</i> was the same as the tropical year. This assumption was incorrect, but the observations in the ancient time were not accurate enough to detect the error of the assumption. So the non-uniform motion of the Sun didn't add another condition to the superior epoch. Thus, in the ideal situation, the superior epoch was the instant  at which the following astronomical phenomena occurred at midnight on a ji&#462; z&#464; day in a ji&#462; z&#464; year: lunar conjunction, winter solstice, the Moon was at perigee (or apogee) and at the ascending (or descending) node, five planets were in the same direction, winter solstice was in the Emptiness mansion.</p>
    
<p>It is almost impossible for the simultaneous occurrence of these astronomical phenomena, but it can be made possible by appropriately adjusting the observational data, as will be demonstrated in the next two sections. In the ideal situation, the cycles involved in the calculation are: sexagenary year cycle (60 years), sexagenary day cycle (60 days), synodic month, tropical year, anomalistic month, nodal month, sidereal year, and the synodic periods of the five planets. From observation, one can determine at a particular winter solstice the number of days each of the relevant quantity was from the beginning of each cycle. One can then set up a system of 11 congruence equations for N, which is the number of years between this winter solstice and the superior epoch.</p>
    
    <br />
<subsect id="mystery">Mystery of the Superior Epoch Computation</subsect>
<p>Chinese mathematicians developed a general algorithm for solving a system of congruence equations no later than the third century. The algorithm was later known as the <i>d&#224; y&#462;n z&#466;ng sh&#249; sh&#249;</i> (大衍總術數) in China and the direct construction proof of the <a href="https://planetmath.org/ChineseRemainderTheorem" target="_blank">Chinese remainder theorem</a> in the West. It was generally believed that this was the algorithm used by the almanac makers to compute the superior epoch. However, there were two major problems with this algorithm. First, the amount of calculation involved is huge. Even with today's computational knowledge, it's still very difficult to carry out the calculation without the assistance of a computer. A more serious problem is that the Chinese remainder theorem requires the divisors to be pairwise coprime in order to guarantee the existence of a solution, but the divisors in the congruence equations for the superior epoch are not pairwise coprime. This means that the equations may not have a solution unless the remainders in the equations satisfy certain conditions, but the Chinese remainder theorem doesn't provide any method to check the existence of a solution. In the case of no solution, there doesn't seem to have an easy way to fix the situation. Another, unrelated, puzzle is that if the number of years from the superior epoch N was computed by solving the 11 congruence equations, it would be a very large number. Upon examining the values of N for all the almanacs that used a superior epoch, it is found that with two exceptions all of them were less than 100 million years, which were too small if they were really the solution of the 11 equations. How, then, did the almanac makers computed the superior epoch?</p>
    
<p>Unfortunately, the ancient computation method was gradually forgotten after the abolishment of the <i>sh&#224;ngyu&#225;n</i> system in 1280. As mentioned above, issuing an accurate almanac was one way to demonstrate that the emperor received the mandate of heaven. Therefore, the production and distribution of annual almanacs were monopolized by the government in Imperial China. The technical details of the almanac construction were kept secret, and private study of astronomy was outlawed. Knowledge of almanac making was transmitted within and shared by a small number of specialists. Official historical records have sections on the astronomical systems used at the time, but they only provide formulae that performed various almanac calculations. The theory behind the formulae and how they were derived were kept secret. In the Ming dynasty (1368-1644), the officials in the Imperial Astronomical Bureau (欽天監) were hereditary. The Ming dynasty kept using the almanac developed in 1280, which abandoned the superior epoch, without trying to improve it. In the late 15th century, the almanac failed to predict a number of eclipses. The astronomers in the imperial court who inherited the position didn't study their craft well and were unable to improve the almanac. The imperial court had to ask the Jesuits for help to construct a new almanac.</p>
    
<p>There were scholars attempting to uncover the mathematical principle behind the ancient almanacs since the 17th century and made a number of discoveries, but the ancient method of computing the superior epoch remained an unsolved problem until about three decades ago when the mathematician Q&#363; &#256;nj&#299;ng (曲安京) solved the mystery. According to his study, only the sexagenary year and day cycle, synodic month and tropical year were involved in the computation of the superior epoch. The observational values of the other astronomical constants such as the anomalistic month, sidereal years and so on were used as a reference and they were adjusted to match the superior epoch. The detail will be explained in the following two sections.</p>
    <br />
<sect id="computation">Computation of the Superior Epoch</sect>
    
<subsect id="description">General Description</subsect>
    
<p>According to Q&#363; &#256;nj&#299;ng, the ancient method of computing the superior epoch can be divided into a few steps. First, choose an integer A to represent the denominator of the synodic month <span class="nowrap">P<sub>L</sub></span>. That is, write <span class="nowrap">P<sub>L</sub></span> = <span class="nowrap">U/A</span> days, where U is another integer. The tropical year <span class="nowrap">P<sub>s</sub></span> (in days) is also expressed as a fraction, as will be explained below. Both the tropical year and synodic month were determined by observations, but they could be expressed as fractions in various ways that were consistent with observations within measurement errors. Use the chosen values of <span class="nowrap">P<sub>L</sub></span>, <span class="nowrap">P<sub>s</sub></span> and other observation data to set up a system of three congruence equations for N, the number of years between the superior epoch and a particular winter solstice. The system of equations are examined to determine if a solution exists, if a solution doesn't exist or if N is greater than 100 million years, the equations are abandoned. Choose another set of U, A and other parameters and set up the equations for N again. The procedure is repeated until an acceptable solution for N is found.</p>
    <br />
<subsect id="equations">Congruence Equations</subsect>
    
<p>Chinese almanacs usually took the winter solstice as the beginning of a year, even though most of the time the beginning of a calendar year was about one or two months after the winter solstice. Take a particular winter solstice as a reference time. Let N be the number of years between this winter solstice and the superior epoch, <span class="nowrap">R<sub>0</sub></span> be the number of years between the reference year and the previous ji&#462; z&#464; year, <span class="nowrap">r<sub>1</sub></span> be the number of days between this winter solstice and midnight on the previous ji&#462; z&#464; day, and <span class="nowrap">r<sub>2</sub></span> be the number of days between this winter solstice and the previous lunar conjunction (i.e. the <a href="https://in-the-sky.org/article.php?term=age_of_moon" target="_blank">age of the Moon</a> of this winter solstice). The equations for N can be written as</p>
<p>N &equiv; R<sub>0</sub> (mod 60), &nbsp;&nbsp; <span class="nowrap">P<sub>s</sub></span>N &equiv; <span class="nowrap">r<sub>1</sub></span> (mod 60), &nbsp;&nbsp;<span class="nowrap">P<sub>s</sub></span> N&equiv; <span class="nowrap">r<sub>2</sub></span> (mod <span class="nowrap">P<sub>L</sub></span>).&nbsp;&nbsp;&nbsp;(1)</p>
<p>Here <span class="nowrap">P<sub>s</sub></span> is the tropical year in days, <span class="nowrap">P<sub>L</sub></span> is the synodic month in days, and &equiv; denotes congruence. The first equation means that <span class="nowrap">N-R<sub>0</sub></span> is an integer multiples of 60. The second equation means that <span class="nowrap">P<sub>s</sub>N - r<sub>1</sub></span> is an integer multiples of 60. The last equation means that <span class="nowrap">P<sub>s</sub>N - r<sub>2</sub></span> is an integer multiples of <span class="nowrap">P<sub>L</sub></span>. Note that <span class="nowrap">R<sub>0</sub></span> is an integer, but <span class="nowrap">r<sub>1</sub></span> and <span class="nowrap">r<sub>2</sub></span> are not. </p>
    
<p>To convert the equations in (1) into equations involving only integers, write the synodic month <span class="nowrap">P<sub>L</sub>=U/A</span>, where both U and A are integers. The tropical year <span class="nowrap">P<sub>s</sub></span> also needs to be expressed in a fraction. There are two ways to do this. The first method was used before the 7th century, in which a <i>zh&#257;ng</i> cycle was specified. A <i>zh&#257;ng</i> cycle is simply the least common multiple of <span class="nowrap">P<sub>L</sub></span> and <span class="nowrap">P<sub>s</sub></span>. Suppose a <i>zh&#257;ng</i> cycle contains p synodic months and q tropical years. Then we have <span class="nowrap">P<sub>s</sub> = pU/(qA)</span>. In the early almanacs, p=235 and q=19 were chosen, so that 235 synodic months were equal to 19 tropical years. Since <span class="nowrap">235=19&times;12+7</span>, 7 leap months had to be inserted in 19 years and the pattern of leap months repeated every 19 years. This particular <i>zh&#257;ng</i> cycle was known as the <i>Metonic cycle</i> in ancient Greece. Other values of p and q were used since the 5th century. For example, p=7421 and q=600 were used in the <i>Xu&#225;nsh&#464;</i> almanac (玄始曆) (221 leap months in 600 years), p=6246 and q=505 in the <i>Zh&#232;nggu&#257;ng</i> almanac (正光曆) (186 leap months in 505 years), p=4836 and q=391 in the <i>D&#224;m&#237;ng</i> almanac (大明曆) created by Z&#468; Ch&#333;ngzh&#299; (144 leap months in 391 years), p=5306 and q=429 in the <i>K&#257;ihu&#225;ng</i> almanac (開皇曆) (158 leap months in 429 years), and so on. In this method, the congruence equations in (1) can be written as</p>
<p>N &equiv; R<sub>0</sub> (mod 60),&nbsp;&nbsp;&nbsp; pUN &equiv; <span class="nowrap">R<sub>1</sub></span> (mod 60qA), &nbsp;&nbsp;&nbsp;pN &equiv; <span class="nowrap">R<sub>2</sub></span> (mod q),&nbsp;&nbsp;&nbsp;(2)</p>
<p>where <span class="nowrap">R<sub>1</sub></span>=<span class="nowrap">qAr<sub>1</sub></span> and <span class="nowrap">R<sub>2</sub></span>=<span class="nowrap">qr<sub>2</sub></span>.</p>
    
<p>The second method was adopted since the middle of 7th century, in which the tropical year was simply written as <span class="nowrap">P<sub>s</sub>=T/A</span>, where T was another integer. The equations in (1) can be written as</p>
<p>N &equiv; R<sub>0</sub> (mod 60),&nbsp;&nbsp;TN&equiv;<span class="nowrap">R<sub>1</sub></span> (mod 60A),&nbsp;&nbsp;TN&equiv;<span class="nowrap">R<sub>2</sub></span> (mod U),&nbsp;&nbsp;&nbsp;(3)</p>
<p>where <span class="nowrap">R<sub>1</sub></span>=<span class="nowrap">Ar<sub>1</sub></span> and <span class="nowrap">R<sub>2</sub></span>=<span class="nowrap">Ar<sub>2</sub></span>. Although the <i>zh&#257;ng</i> cycle is not specified, it can still be calculated by finding the least common multiple of <span class="nowrap">T/A</span> and <span class="nowrap">U/A</span>. However, the computation of lunar conjunctions used for calendars took into account the non-uniform motion of the Moon since the 7th century, whereas only the mean motion of the Moon was taken into account for calendars before. So the <i>zh&#257;ng</i> cycle no longer corresponded to the cycle of leap months. As will be explained below, the values of U, T and A may need to be adjusted in order for the congruence equations to have a solution. When a <i>zh&#257;ng</i> cycle is pre-specified, only U and A can be adjusted. Whereas in the second method U, T and A can be adjusted freely. This is the difference between the two methods in the computation of the superior epoch.</p>
    <br />
<subsect id="conditions">Conditions for the Existence of a Solution</subsect>

<p>As mentioned above, it is not guaranteed that the system of congruence equations will have a solution. It's not difficult to derive the necessary and sufficient conditions for the existence of a solution. I will use the equations in (3) as an example. From the first equation we can write <span class="nowrap">N=R<sub>0</sub>+60m</span>, where m is an arbitrary integer. Substituting this expression into the middle equation in (3) gives</p>
<p>T(R<sub>0</sub>+60m)=R<sub>1</sub>+60An,<p>
<p>where n is an integer. This equation can be written as</p>
<p>60g<sub>1</sub>(mt-na)=R<sub>1</sub>-TR<sub>0</sub>,&nbsp;&nbsp;&nbsp;(4)</p>
<p>where g<sub>1</sub>=gcd(T,A) is the greatest common divisor of T and A, <span class="nowrap">t=T/g<sub>1</sub></span> and <span class="nowrap">a=A/g<sub>1</sub></span>. It follows that t and a are relatively prime. Since <span class="nowrap">mt-na</span> is an integer, the equation has a solution iff <span class="nowrap">60g<sub>1</sub> | (R<sub>1</sub>-TR<sub>0</sub>)</span>, i.e. <span class="nowrap">60g<sub>1</sub></span> divides <span class="nowrap">(R<sub>1</sub>-TR<sub>0</sub>)</span>. So far only the first two equations in (3) are examined. There are two more conditions when we add the last equation into the mix. Substituting the general solution <span class="nowrap">N=R<sub>0</sub>+60m</span> into the last equation in (3) and following the same argument, we find the second necessary and sufficient condition: <span class="nowrap">g<sub>2</sub>|(R<sub>2</sub>-R<sub>0</sub>T)</span>, where <span class="nowrap">g<sub>2</sub>=gcd(60T,U)</span>. The last condition can be derived by substituting the general solution of the middle equation in (3) to the last equation. The result is <span class="nowrap">g<sub>3</sub>|(R<sub>1</sub>-R<sub>2</sub>)</span>, where <span class="nowrap">g<sub>3</sub>=gcd(60A,U)</span>. To sum up, the system of congruence equations in (3) has a solution iff</p>
<p>60g<sub>1</sub>|(R<sub>1</sub>-TR<sub>0</sub>),&nbsp;&nbsp;<span class="nowrap">g<sub>2</sub>|(R<sub>2</sub>-R<sub>0</sub>T)</span>,&nbsp;&nbsp;<span class="nowrap">g<sub>3</sub>|(R<sub>1</sub>-R<sub>2</sub>)</span>,<br />
g<sub>1</sub>=gcd(T,A),&nbsp;&nbsp;<span class="nowrap">g<sub>2</sub>=gcd(60T,U)</span>&nbsp;&nbsp;<span class="nowrap">g<sub>3</sub>=gcd(60A,U)</span>.</p> 
<p>If these conditions are not satisfied, the remainders <span class="nowrap">R<sub>1</sub>=Ar<sub>1</sub></span> and <span class="nowrap">R<sub>2</sub>=Ar<sub>2</sub></span> will need to be adjusted. However, values of <span class="nowrap">r<sub>1</sub></span> and <span class="nowrap">r<sub>2</sub></span> are obtained from observations and they have little rooms for adjustment. The general principle was that values of <span class="nowrap">r<sub>1</sub></span> and <span class="nowrap">r<sub>2</sub></span> cannot deviate from observations by more than 0.01 days. If it is impossible to find <span class="nowrap">R<sub>1</sub></span> and <span class="nowrap">R<sub>2</sub></span> within the acceptable range, another set of U, T and A has to be chosen so that <span class="nowrap">U/A</span> and <span class="nowrap">T/A</span> can approximate <span class="nowrap">P<sub>L</sub></span> and <span class="nowrap">P<sub>s</sub></span> within measurement errors. Another set of congruence equations are set up based on these new parameters. The remainders <span class="nowrap">R<sub>1</sub></span> and <span class="nowrap">R<sub>2</sub></span> are then tuned to satisfy the conditions. If this fails again, the procedure of choosing a new set of T, U, A, <span class="nowrap">R<sub>1</sub></span> and <span class="nowrap">R<sub>2</sub></span> has to be repeated until a suitable set of parameters is found.</p>
<p>However, the procedure described above was probably not the method used by the ancient almanac makers to adjust the parameters. The adjustments were probably carried out while solving the equations using the <i>y&#462;nj&#236;</i> algorithm described below.</p>
    <br />
<subsect id="yanji"><i>Y&#462;nj&#236;</i> Algorithm (演 紀 術)</subsect>

<p>The ancient Chinese used the <i>y&#462;nj&#236;</i> algorithm (演紀術) to solve the system of congruence equations. The algorithm is very simple. Here I again use the system of equations in (3) as an example. The algorithm takes one equation at a time. Let's start with the first equation in (3). We have found that the general solution is <span class="nowrap">N=R<sub>0</sub>+60m</span>. The next step is to substitute this general solution into the second equation. This has also been done above and the result is equation (4). The condition <span class="nowrap">60g<sub>1</sub>|(R<sub>1</sub>-TR<sub>0</sub>)</span> has to be satisfied in order to have a solution. The parameter <span class="nowrap">R<sub>1</sub></span> is tuned to satisfy the condition. If it's impossible to find an <span class="nowrap">R<sub>1</sub></span> in the acceptable range. Another set of parameters A, U and T have to be chosen. Suppose an acceptable <span class="nowrap">R<sub>1</sub></span> is found. Equation (4) can be written as</p>
<p><span class="nowrap">mt - na</span> = <span class="nowrap">S<sub>1</sub></span>,&nbsp; where <span class="nowrap">S<sub>1</sub></span> = <span class="nowrap">(R<sub>1</sub> - TR<sub>0</sub>)/(60g<sub>1</sub>)</span>,<br />
&rArr;&nbsp;&nbsp;mt &equiv; S<sub>1</sub> (mod a).</p>
    
<p>This equation can be solved by first considering the equation <span class="nowrap">&mu;t &equiv; 1 (mod a)</span>. Here &mu; is known as the <i>modular multiplicative inverse</i> of t. The modular multiplicative inverse can be calculated using the <i>d&#224; y&#462;n qi&#250; y&#299; sh&#249;</i> (大衍求一術), which is equivalent to the <a href="https://en.wikipedia.org/wiki/Extended_Euclidean_algorithm" target="_blank">extended Euclidean algorithm</a>. After &mu; is solved, m is obtained by multiplying &mu; by <span class="nowrap">S<sub>1</sub></span>. Note that m is not unique. Adding m to any multiples of a is also a solution. Let M be the smallest positive solution. Then the general solution is <span class="nowrap">m=M+ka</span>, where k is any integer. The number <span class="nowrap">N<sub>0</sub>=R<sub>0</sub>+60M</span> is the number of years between the particular winter solstice and the previous winter solstice that occurred at midnight on a ji&#462; z&#464; day in a ji&#462; z&#464; year, but this was not a lunar conjunction. So the integer k needs to be determined in order for the epoch to coincide with the lunar conjunction. Substituting the general solution <span class="nowrap">N=R<sub>0</sub>+60(M+ka)</span> into the last equation in (3) yields</p>
<p>TR<sub>0</sub> + 60T(M + ka) = R<sub>2</sub> + Ub,&nbsp; where b is an integer,<br />
&rArr;&nbsp;&nbsp;60Tak - Ub = R<sub>2</sub> - TR<sub>0</sub> - 60TM.</p>
<p>The equation has a solution iff <span class="nowrap">gcd(60Ta,U)|(R<sub>2</sub>-TR<sub>0</sub>-60TM)</span>. We need to adjust the parameter <span class="nowrap">R<sub>2</sub></span> to satisfy the condition. If it's impossible to find <span class="nowrap">R<sub>2</sub></span> in the acceptable range, we will have to choose another set of parameters A, T and U and start over the calculation. Suppose an acceptable <span class="nowrap">R<sub>2</sub></span> is found.</p>
<p>Let <span class="nowrap">g = gcd(60Ta,U)</span>, <span class="nowrap">v = 60Ta/g</span>, <span class="nowrap">u = U/g</span>, <span class="nowrap">S<sub>3</sub> = (R<sub>2</sub> - TR<sub>0</sub> - 60TM)/g</span>，then<br />
<span class="nowrap">vk - ub = S<sub>3</sub></span>&nbsp;&rArr;&nbsp;<span class="nowrap">vk &equiv; S<sub>3</sub> (mod u)</span>.</p>
<p>To find k, we can find the modular multiplicative inverse of v using the extended Euclidean algorithm and then multiply the result by <span class="nowrap">S<sub>3</sub></span>. We then add an appropriate multiple of u to obtain the smallest positive solution K. The final solution is <span class="nowrap">N=R<sub>0</sub>+60(M+Ka)</span>. However, there is another stupulation: if N is greater than 100 million years, the solution is rejected. In that case, we need to choose another set of parameters A, U, T, <span class="nowrap">R<sub>1</sub></span> and <span class="nowrap">R<sub>2</sub></span> and start over. The procedure may need to be repeated a few times until an acceptable N is obtained.</p>
    
<p>By tackling one equation at a time, the amount of computation involved in the <i>y&#462;nj&#236;</i> algorithm is much less than the Chinese remainder theorem, which involves the multiplication of large numbers. Since the numbers T, U, and A tend to be large, the amount of computation saved is tremendous.</p>
    
<p>When an acceptable value of N is obtained, the next step is to adjust the other astronomical constants to match the superior epoch.</p>
    
    <br />
<sect id="constants">Adjustment of Astronomical Constants</sect>
    
<p>As seen above, the computation of superior epoch only involves the sexagenary year and day cycle, tropical year and synodic month. The superior epoch is also supposed to be the time origin of the other cycles, but those cycles are not involved in the calculation. So there are mismatches between the observation data and the computed superior epoch. To remove the discrepancies, we need to adjust the astronomical constants. Here I take the anomalistic month as an example to demonstrate how this can be done.</p>
    
<p>Let floor(x) denote the greatest integer smaller than or equal to x, and<br />
mod(X,Y) = X - Y&middot;floor(X/Y)<br />
be the remainder of X divided by Y.</p>
<p>Suppose in a hypothetical almanac the superior epoch is calculated to be 10,000 years from a particular winter solstice and the tropical year is taken to be <span class="nowrap">(365 + 97/400)</span> days = 365.2425 days. Suppose it was determined from observations that the Moon was 12.3457 days past the perigee at that winter solstice and the anomalistic month was measured to be 27.5546 days. Are these observation data consistent with the superior epoch? The number of days between the superior epoch and the winter solstice was 3652425 days. If we assume the Moon was at perigee at the superior epoch and the anomalistic month was 27.5546 days, it would be <span class="nowrap">mod(3652425, 27.5546)</span> = 7.6608 days past the perigee at the winter solstice, which is clearly inconsistent with the observation data. To remove the discrepancy, we will need to adjust the value of the anomalistic month  to <span class="nowrap">P<sub>a</sub></span> so that <span class="nowrap">mod(3652425,P<sub>a</sub>)</span> = 12.3457. It follows that <span class="nowrap">3652425-12.3457</span> is an integer multiple of <span class="nowrap">P<sub>a</sub></span>, or <span class="nowrap">P<sub>a</sub></span> = 3652412.6543/n, where n is a positive integer. It is desirable to choose <span class="nowrap">P<sub>a</sub></span> to be as close to the measured value as possible. If <span class="nowrap">P<sub>a</sub></span> = 27.5546, n would be <span class="nowrap">3652412.6543/27.5546</span> = 1332551.83, which is not an integer. We can take the nearest integer and set <span class="nowrap">P<sub>a</sub></span> = <span class="nowrap">3652412.6543/132552</span> = 27.55456465613495 days, which is only 3 seconds less than the measurement value. We can safely assume that the measurement error in the ancient time was much greater, so no accuracy would be lost by adjusting the anomalistic month to this value. The problem is that this particular <span class="nowrap">P<sub>a</sub></span> is not a simple fraction and is inconvenient for almanac calculations. So the almanac makers would prefer to choose another value that could both be close to the observation value within measurement error and could be expressed as a simpler fraction. The larger N is, the easier it is to find a simpler fraction to approximate the measurement value and to match the superior epoch.</p>
    
<p>In our current system, astronomical constants are classified as the defining constants, primary constants and derived constants. An example of a defining constant is the speed of light, which is defined as 299792458 m/s. Primary constants are determined by observations. An example is Earth's equatorial radius. Derived constants are obtained by combining the primary constants or defining constants or both. An example is the mass ratio of the Sun and Earth. In this sense, the astronomical constants determined by matching the superior epoch, such as the anomalistic month, sidereal year and so on,  were derived constants. This seems weird because one would think that these should be constants determined from observations. However, in the ancient <i>sh&#224;ngyu&#225;n</i> system, the measurement values were taken for reference only, the actual values used in the almanacs were determined by adjusting the measurement values to match the calculated superior epoch. Of course, in order for an almanac to be accurate, the adjusted values cannot deviate too much from the measurement values.</p>
    
<p>Even in the ancient time, not everyone thought that adjusting the astronomical constants to match the superior epoch was a good idea. For example, in the 4th century, a scholar named D&#249; Y&#249; (杜預) quoted the ancient texts saying that one should make predictions based on observations, instead of altering the measurement values to make predictions and hoping the results would match the observations. In 237, the <i>J&#464;ngch&#363;</i> almanac (景初曆) was constructed, in which the anomalistic month was not tied to the superior epoch. As a result, the adopted anomalistic month was much closer to the measurement value than the previous almanac. In 443, astronomer H&#233; Ch&#233;ngti&#257;n (何承天) created the <i>Yu&#225;nji&#257;</i> almanac (元嘉曆), in which the synodic periods of the five planets were based on observations and had their own epochs separate from the superior epoch. The adopted synodic periods were much more accurate than the previous almanacs. H&#233; agreed with D&#249; Y&#249; that astronomical constants should be determined by observations only. However, H&#233;'s approach received criticisms and subsequent almanac makers didn't follow his approach.</p>
    
<p>From the example above, we see that as long as the number of years N from the superior epoch is large, it's easier to approximate the measurement values to match the superior epoch without sacrificing almanac accuracy. However, large N made almanac calculations inconvenient. So there was a tradeoff between computational convenience and accuracy. The upper bound for N was chosen to be 100 million years. As observation accuracy continued to improve, the restriction on N became the limiting factor for the almanac accuracy, eventually leading to the abolishment of the superior epoch.</p>
    
    <br />
<sect id="abolishment">Abolishment of the Superior Epoch</sect>
    
<p>The major issue with the superior epoch was its tedious computation. It not only didn't help with the almanac making but also became an obstacle to the further improvement of almanacs.</p>
    
<p>As the measurement precision continued to improve, values of the tropical year and synodic month had to be approximated by more complicated fractions. That is, values of T, U and A became large, resulting in large values of N. A large value of N was inconvenient for almanac calculation, so people tried to limit N to be less than 100 million years. The restriction limited the improvement of the almanac accuracy. There were 19 almanacs used between 960 and 1279, which means that on average a new almanac was created every 17 years. This shows, on one hand, the improvement in measurement precision and that errors in almanacs were easy to detect. On the other hand, it shows that there was little improvement in the accuracy of the almanacs over these 319 years. The main reason was probably because the almanacs were restricted by the limitation imposed by the superior epoch.</p>
    
<p>In 1280, the <i>Sh&#242;ush&#237;</i> almanac (授時曆) was created and the superior epoch was abandoned.  This almanac was used from 1281 to 1368. When the Ming dynasty was established in 1368, it was renamed as the <i>D&#224;t&#466;ng</i> almanac (大統曆), but   <i>D&#224;t&#466;ng</i> almanac was the same as the <i>Sh&#242;ush&#237;</i> almanac with only a small modification. It was used until 1644. So the <i>Sh&#242;ush&#237;</i> almanac was used for more than 360 years. There are several reasons why the <i>Sh&#242;ush&#237;</i> almanac was the most accurate ancient almanacs. Apart from the abolishment of the superior epoch, the improvement in observation devices greatly reduced the measurement errors. The almanac also took advantage of the mathematical techniques developed over the past centuries.</p>
    <br />
<h2 id="references">References</h2>
    
<ul style="list-style-type:none;">
    
<li id="Qu2005a"><p><span class="ref">[1]</span> Q&#363;, &#256;nj&#299;ng (曲安京), <i>Zh&#333;ng gu&#243; l&#236; f&#462; y&#468; sh&#249; xu&#233;</i> (《中国历法与数学》 or <i>Chinese Astronomical Systems and Mathematics</i>), Science Press (Beijing), March, 2005.</p></li>
    
<li id="Qu2005b"><p><span class="ref">[2]</span> Q&#363;, &#256;nj&#299;ng (曲安京), <i>Zh&#333;ng gu&#243; sh&#249; l&#464; ti&#257;n w&#233;n xu&#233;</i> (《中国数理天文学》 or <i>Chinese Mathematical Astronomy</i>), Science Press (Beijing), May, 2005.</p></li>
</ul>

</div> <!-- end of wrapper -->
<br /><br />

</body>
</html>
